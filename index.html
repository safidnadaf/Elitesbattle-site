<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ElitesBattle Esports — Nepal</title>
  <meta name="description" content="ElitesBattle Esports — Nepal-based PUBG MOBILE tournaments. Register, vote, and compete for prizes (paid after admin verification).">
  <link rel="icon" href="elitebattle_assets/elitebattle_icon.png" sizes="32x32">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html{scroll-behavior:smooth}
    /* Main View Toggle */
    .hidden-view{display:none !important}
    .glass{background:rgba(17,17,17,.6);backdrop-filter:blur(8px)}
    .card{border:1px solid rgba(255,255,255,.08)}
    .grid-auto{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:.75rem}
    .hero-bg{
      background:
        radial-gradient(80% 120% at 10% 0%, rgba(148,87,235,.25), transparent 60%),
        radial-gradient(80% 120% at 90% 0%, rgba(64,224,208,.18), transparent 60%),
        linear-gradient(180deg, #0b0b10 0%, #121018 60%, #0b0b10 100%);
    }
    /* Navbar hover underline animation */
    .nav-link{position:relative;transition:color .25s ease}
    .nav-link::after{
      content:""; position:absolute; left:0; bottom:-6px; height:2px; width:100%;
      background:linear-gradient(90deg,#fff,#a7a7ff);
      transform:scaleX(0); transform-origin:left; transition:transform .25s ease;
      opacity:.9;
    }
    .nav-link:hover{color:#fff}
    .nav-link:hover::after{transform:scaleX(1)}
    /* Buttons micro-interactions */
    .btn{transition:transform .12s ease, box-shadow .12s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    /* Sticky header shadow on scroll */
    .header-shadow{box-shadow:0 6px 20px rgba(0,0,0,.25)}
    table{border-collapse:collapse;width:100%}
    th,td{border-bottom:1px solid rgba(255,255,255,.08); padding:.6rem .5rem; font-size:.9rem}
    th{color:#c9c9d9;text-align:left}
    .badge{display:inline-block;padding:.15rem .45rem;border-radius:.5rem;font-size:.72rem}
    .badge-amber{background:#3a2a00;color:#ffd889;border:1px solid rgba(255,216,137,.2)}
    
    /* MODE SWITCHER STYLES */
    .mode-group{display: flex; border: 1px solid rgba(255,255,255,.2); border-radius: 0.5rem; overflow: hidden; width: fit-content;}
    .mode-group .mode-btn{
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: background-color 0.15s, color 0.15s;
        border-radius: 0;
        border: none;
        background-color: transparent;
        color: rgba(255, 255, 255, 0.7);
    }
    .mode-group .mode-btn + .mode-btn{border-left: 1px solid rgba(255,255,255,.2);}
    .mode-group .mode-btn.active{background-color: white; color: black; font-weight: 600;}

    /* Registered Players modal tabs */
    .player-mode-btn{
      transition: background-color .15s, color .15s, border-color .15s;
      border: 1px solid rgba(255,255,255,.2);
      background: transparent;
      color: rgba(255,255,255,.85);
    }
    .player-mode-btn.active{
      background: #fff;
      color: #000;
      border-color: #fff;
      font-weight: 600;
    }

    /* Payment Remarks box */
    .payment-remark-box {
      background: rgba(17, 17, 17, 0.6);
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Toast Notification (CRITICAL FIX: non-interactive) */
    #toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        transition: opacity 0.3s, transform 0.3s;
        pointer-events: none; /* so it never blocks nav clicks */
    }
    .toast {
        background-color: #10B981;
        color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        pointer-events: auto; /* buttons inside toast still clickable if added */
    }

    /* Cookie Banner */
    #cookie-banner {
        position: fixed;
        bottom: 0; left: 0; right: 0;
        z-index: 50;
        background: #1f2937;
        color: white;
        padding: 1rem;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        display: flex; justify-content: space-between; align-items: center;
        transform: translateY(100%);
        transition: transform 0.3s ease-in-out;
        font-size: 0.875rem;
    }
    #cookie-banner.show { transform: translateY(0); }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100">
  <header id="siteHeader" class="sticky top-0 z-40 bg-neutral-950/80 backdrop-blur border-b border-white/10 transition-shadow">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="#top" class="leading-tight">
        <div class="text-xl md:text-2xl font-extrabold tracking-wide">ELITESBATTLE ESPORTS</div>
        <div class="text-[11px] md:text-xs text-white/70 -mt-0.5">NEPAL TOURNAMENTS</div>
      </a>
      <nav class="flex items-center gap-6 text-sm">
        <a href="#tournament" class="nav-link">Tournament</a>
        <a href="#poll" class="nav-link">Poll</a>
        <a href="#fairplay" class="nav-link">Fair Play</a>
        <a href="#terms" class="nav-link">T&Cs</a>
        <a href="#privacy" class="nav-link">Privacy</a>
        <a href="#admin-login" class="nav-link" id="adminNav">Admin</a>
      </nav>
      </div>
  </header>

  <div id="toast-container" class="opacity-0 translate-x-full"></div>

  <div id="cookie-banner">
    <p>This website uses cookies for analytics and user preferences. By continuing, you agree to their use.</p>
    <div class="flex gap-2 ml-4">
        <button id="accept-cookies" class="btn px-3 py-1 rounded-md bg-white text-black text-sm font-semibold">Accept</button>
        <button id="deny-cookies" class="btn px-3 py-1 rounded-md border border-white/50 text-white text-sm hover:bg-white/10">Deny</button>
    </div>
  </div>

  <section id="public-view" class="active-view">
    
    <section id="top" class="relative overflow-hidden hero-bg">
      <div class="absolute inset-0" aria-hidden="true"
          style="background-image: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.35) 30%, rgba(0,0,0,.65));"></div>
      <div class="relative max-w-6xl mx-auto px-4 py-16 md:py-24">
        <div class="max-w-3xl">
          <p class="text-sm tracking-widest text-white/80 uppercase">ELITESBATTLE ESPORTS</p>
          <h1 class="mt-2 text-4xl md:text-6xl font-extrabold leading-tight">
            Nepal’s Online PUBG MOBILE Tournaments
          </h1>
          <p class="mt-4 text-neutral-200 md:text-lg">
            Join The ElitesBattle Revolution And Become A Part Of The Ultimate Esports Community!
          </p>
          <p class="mt-2 text-neutral-300">
            Vote for the next match, register to play, be ready 30 minutes before start, and compete. Prizes are paid after admin verification.
          </p>
          <div class="mt-6 flex gap-3">
            <a href="#tournament" class="btn px-4 py-2 rounded-xl bg-white text-black font-semibold">View Tournament</a>
            <button id="openRegister2" class="btn px-4 py-2 rounded-xl border border-white/20 hover:bg-white/10">Register Now</button>
          </div>
        </div>
      </div>

      <section class="max-w-6xl mx-auto px-4 -mt-6 md:-mt-10 pb-10">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          <div class="glass card rounded-2xl p-4 text-center">
            <div class="text-xs text-neutral-400 uppercase">Total Matches</div>
            <div id="statMatches" class="text-2xl font-bold">0</div>
          </div>
          <div class="glass card rounded-2xl p-4 text-center">
            <div class="text-xs text-neutral-400 uppercase">Total Players</div>
            <div id="statPlayers" class="text-2xl font-bold">0</div>
          </div>
          <div class="glass card rounded-2xl p-4 text-center">
            <div class="text-xs text-neutral-400 uppercase">Total Winnings (NPR)</div>
            <div id="statWinnings" class="text-2xl font-bold">0</div>
          </div>
          <div class="glass card rounded-2xl p-4 text-center">
            <div class="text-xs text-neutral-400 uppercase">Top Reward (NPR)</div>
            <div id="statTopReward" class="text-2xl font-bold">0</div>
          </div>
        </div>
      </section>
    </section>

    <section id="tournament" class="max-w-6xl mx-auto px-4 py-10">
      <div class="grid md:grid-cols-2 gap-4">
        <div class="glass card rounded-2xl p-5">
          <h2 class="text-xl font-semibold">Upcoming Match</h2>
          <div class="mt-1 text-neutral-300 text-sm">Match ID: <span id="matchId">EBE-NEP-0001</span></div>
          <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
            <div class="rounded-xl card p-3"><div class="text-neutral-400">Date</div><div id="matchDate" class="text-lg font-semibold">05 Nov 2025, 8:00 PM</div></div>
            <div class="rounded-xl card p-3"><div class="text-neutral-400">Check-in</div><div id="checkin" class="text-lg font-semibold">Be ready 7:30–7:50 PM</div></div>
            <div class="rounded-xl card p-3"><div class="text-neutral-400">Map</div><div id="map" class="text-lg font-semibold">Erangel</div></div>
            <div class="rounded-xl card p-3"><div class="text-neutral-400">Prize</div><div id="prize" class="text-lg font-semibold">Rs 3,000 + Rs 2,500 Special Award</div></div>
          </div>

          <div class="mt-4">
            <h3 class="font-semibold mb-2">Mode & Entry Fees</h3>
            <div id="modeSwitcher" class="mode-group text-sm">
                <button data-mode="solo" class="mode-btn active">Solo</button>
                <button data-mode="duo" class="mode-btn">Duo</button>
                <button data-mode="squad" class="mode-btn">Squad</button>
            </div>
            <div class="rounded-xl card p-3 mt-3">
                <div class="text-neutral-400 text-sm">Current Entry Fee</div>
                <div id="currentEntryFee" class="text-xl font-semibold">Rs 100</div>
            </div>
          </div>

          <div class="mt-4">
            <h3 class="font-semibold mb-2">Live Slots (Mode: <span id="currentModeLabel">Solo</span>, Map: <span id="slotMap">Erangel</span>)</h3>
            <div class="grid-auto text-sm" id="slotGrid"></div>
            <p class="text-xs text-neutral-400 mt-2">* Slot data loaded from mock backend.</p>
          </div>

          <div class="mt-5 flex flex-wrap gap-3">
            <button id="openRegister3" class="btn px-4 py-2 rounded-xl bg-white text-black font-semibold">Register for <span id="regModeBtn">Solo</span></button>
            <button id="viewRegisteredPlayersBtn" class="btn px-4 py-2 rounded-xl border border-white/20 hover:bg-white/10">View Registered Players</button>
          </div>
        </div>

        <div class="glass card rounded-2xl p-5">
          <h3 class="text-lg font-semibold">About ElitesBattle Esports</h3>
          <p class="mt-2 text-neutral-300 text-sm">
            ElitesBattle Esports is a Nepal-based online tournament organizer for skill-based PUBG MOBILE competitions.
            Matches are recorded (<strong>VOD = Video on Demand</strong>) and reviewed by admins before payouts. Players must be 16+.
          </p>
          <div class="mt-4 grid-auto">
            <div class="rounded-xl card p-3"><div class="text-neutral-400 text-sm">Fair Play</div><div class="font-semibold">No emulators, no third-party tools, no cheating. <strong>DQ = Disqualified</strong> for rule violations.</div></div>
            <div class="rounded-xl card p-3"><div class="text-neutral-400 text-sm">Payouts</div><div class="font-semibold">Prizes paid after admin verification (within 5 hours).</div></div>
            <div class="rounded-xl card p-3"><div class="text-neutral-400 text-sm">Special Award</div><div class="font-semibold">Rs 2,500 Most Entertaining Player — community vote; if tied/unclear, admins decide.</div></div>
          </div>
        </div>
      </div>
    </section>

    <section id="poll" class="max-w-6xl mx-auto px-4 py-10">
      <div class="glass card rounded-2xl p-5">
        <h2 class="text-xl font-semibold">Community Poll — Help Decide the Next Match</h2>
        <form id="pollForm" class="grid md:grid-cols-4 gap-3 mt-4 text-sm">
          <div><label class="block mb-1">Preferred Date</label><input id="pollDate" type="date" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" required></div>
          <div><label class="block mb-1">Map</label><select id="pollMap" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" required><option>Erangel</option><option>Livik</option><option>Sanhok</option><option>Miramar</option><option>Vikendi</option></select></div>
          <div><label class="block mb-1">Time</label><select id="pollTime" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" required>
            <option>7:00 PM</option><option>7:30 PM</option><option selected>8:00 PM</option>
            <option>8:30 PM</option><option>9:00 PM</option>
          </select></div>
          <div><label class="block mb-1">Mode</label><select id="pollMode" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" required><option selected>Solo</option><option>Duo</option><option>Squad</option></select></div>
          <div class="md:col-span-4">
            <button class="btn px-4 py-2 rounded-xl bg-white text-black font-semibold" type="submit">Submit Vote</button>
            </div>
        </form>
        <p class="text-xs text-neutral-400 mt-3">* Poll votes saved via mock backend.</p>
      </div>
    </section>

    <section id="fairplay" class="max-w-6xl mx-auto px-4 py-10">
      <div class="glass card rounded-2xl p-5">
        <h2 class="text-xl font-semibold">Fair Play Policy</h2>
        <ul class="list-disc pl-5 mt-3 space-y-2 text-neutral-300 text-sm">
          <li><strong>Mobile only:</strong> Emulators/controllers/VPN abuse are not allowed.</li>
          <li><strong>Cheating:</strong> Third-party tools, teaming with outsiders, stream sniping, or glitch abuse → <strong>DQ (Disqualified)</strong>, ban, prize loss.</li>
          <li><strong>Verification:</strong> Matches are recorded (<strong>VOD = Video on Demand</strong>) and may be reviewed.</li>
          <li><strong>Check-in:</strong> Be ready 30 minutes before start (7:30–7:50 PM). No-show = no credit.</li>
          <li><strong>Conduct:</strong> No harassment/toxicity; respect admins and players.</li>
          <li><strong>Payouts:</strong> Prizes paid via Nepali methods after admin verification (within 5 hours).</li>
        </ul>
        <p class="mt-4 text-neutral-400 text-sm"><strong>Eligibility:</strong> 16+ only (PUBG Mobile rating).</p>
      </div>
    </section>

    <section id="terms" class="max-w-6xl mx-auto px-4 py-10">
      <div class="glass card rounded-2xl p-5">
        <h2 class="text-xl font-semibold">Terms &amp; Conditions (Key Points)</h2>
        <ol class="list-decimal pl-5 mt-3 space-y-2 text-neutral-300 text-sm">
          <li><strong>Organizer:</strong> ElitesBattle Esports — Nepal.</li>
          <li><strong>Fees & Prizes:</strong> Entry fees in NPR. Prizes paid after admin verification (within 5 hours).</li>
          <li><strong>Cancellations:</strong> If organizer cancels, entrants receive a free re-entry credit to a future match of equal value.</li>
          <li><strong>Data:</strong> We collect name, PUBG ID, and WhatsApp number for tournament operations only.</li>
        </ol>
      </div>
    </section>

    <section id="privacy" class="max-w-6xl mx-auto px-4 py-10">
      <div class="glass card rounded-2xl p-5">
        <h2 class="text-xl font-semibold">Privacy Notice</h2>
        <p class="mt-3 text-neutral-300 text-sm">
          We collect your name, PUBG ID, and WhatsApp number to manage tournament registration, check-in, communication, and prize payouts.
          We do not sell your data. You may request deletion after the tournament ends, except data kept for legal/accounting purposes.
        </p>
      </div>
    </section>
    
    </section>

  <section id="admin-view" class="hidden-view">
    
    <section id="admin-login" class="max-w-sm mx-auto px-4 py-16">
      <div class="glass card rounded-2xl p-6">
        <h2 class="text-xl font-semibold">Admin Login</h2>
        <p class="text-sm text-neutral-400 mt-1">Enter your admin PIN to continue.</p>
        <form id="adminLoginForm" class="mt-4 space-y-3">
          <div>
            <label class="block mb-1 text-sm">Admin PIN</label>
            <input id="adminPin" type="password" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="Enter PIN" required>
          </div>
          <button class="btn w-full py-2 rounded-xl bg-white text-black font-semibold" type="submit">Login</button>
          <p class="text-xs text-neutral-500 mt-2">Default PIN: <code>EBE2025</code> (change it in Dashboard).</p>
        </form>
      </div>
    </section>

    <section id="admin" class="max-w-6xl mx-auto px-4 py-10 hidden">
      <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">Admin Dashboard</h2>
          <button id="logoutAdmin" class="btn px-4 py-2 rounded-xl bg-red-800 hover:bg-red-700 text-white font-semibold">Logout</button>
      </div>
      <div class="grid lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-1 space-y-6">
            <div class="glass card rounded-2xl p-5">
                <h3 class="text-lg font-semibold mb-3">Match Settings</h3>
                <form id="matchForm" class="mt-3 text-sm space-y-3">
                    <div><label class="block mb-1">Match ID (Next Match)</label><input id="admMatchId" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10"></div>
                    <div><label class="block mb-1">Date & Time (display)</label><input id="admMatchDate" type="text" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="e.g., 05 Nov 2025, 8:00 PM"></div>
                    <div><label class="block mb-1">Check-in Window</label><input id="admCheckin" type="text" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="e.g., Be ready 7:30–7:50 PM"></div>
                    <div><label class="block mb-1">Map</label><select id="admMap" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10"><option>Erangel</option><option>Livik</option><option>Sanhok</option><option>Miramar</option><option>Vikendi</option></select></div>
                    <div><label class="block mb-1">Prize (display)</label><input id="admPrize" type="text" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="Rs 3,000 + Rs 2,500 Special Award"></div>
                    <div class="grid grid-cols-3 gap-2">
                        <div><label class="block mb-1">Solo Fee</label><input id="admFeeSolo" type="number" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" value="100"></div>
                        <div><label class="block mb-1">Duo Fee</label><input id="admFeeDuo" type="number" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" value="200"></div>
                        <div><label class="block mb-1">Squad Fee</label><input id="admFeeSquad" type="number" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" value="400"></div>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <div><label class="block mb-1">Cap Solo</label><input id="admCapSolo" type="number" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" value="100"></div>
                        <div><label class="block mb-1">Cap Duo</label><input id="admCapDuo" type="number" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" value="50"></div>
                        <div><label class="block mb-1">Cap Squad</label><input id="admCapSquad" type="number" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" value="25"></div>
                    </div>
                    <div class="pt-1 flex gap-2">
                        <button class="btn px-4 py-2 rounded-xl bg-white text-black font-semibold" type="submit">Publish New Match</button>
                    </div>
                </form>
            </div>

            <div class="glass card rounded-2xl p-5">
                <h4 class="font-semibold text-sm mb-2">Admin PIN Update</h4>
                <form id="pinForm" class="text-sm space-y-2">
                    <input id="newPin" placeholder="New PIN" type="password" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10">
                    <button class="btn px-4 py-2 rounded-xl border border-white/20 hover:bg-white/10" type="submit">Update PIN</button>
                </form>
            </div>
            
            <div class="glass card rounded-2xl p-5 bg-red-900/20">
                <h4 class="font-semibold text-sm mb-3 text-red-400">Danger Zone</h4>
                <button id="wipeAllData" class="btn w-full py-2 rounded-xl bg-red-700 hover:bg-red-600 text-white font-semibold" type="button">WIPE ALL TOURNAMENT DATA</button>
                <p class="text-xs text-red-300 mt-2">Warning: This clears ALL registrations and polls across ALL match IDs. Keep your PIN and Match Settings.</p>
            </div>

        </div>

        <div class="glass card rounded-2xl p-5 lg:col-span-2">
          <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Registrations (<span id="regMatchIdTitle">Current Match</span>)</h3>
            <div class="flex gap-2">
              <button id="exportAllRegsAdmin" class="btn px-3 py-2 rounded-xl border border-white/20 hover:bg-white/10 text-sm">Export ALL Registrations CSV</button>
              <button id="exportRegsAdmin" class="btn px-3 py-2 rounded-xl border border-white/20 hover:bg-white/10 text-sm" type="button">Export Match CSV</button>
              <button id="exportPollAdmin" class="btn px-3 py-2 rounded-xl border border-white/20 hover:bg-white/10 text-sm" type="button">Export Poll CSV</button>
              <button id="clearMatchData" class="btn px-3 py-2 rounded-xl bg-red-800 hover:bg-red-700 text-white text-sm" type="button">Clear Match Data</button>
            </div>
          </div>
          <p class="text-xs text-neutral-400 mt-1">Review the PUBG ID/Remarks to confirm payment matching. Data is only for the current match.</p>
          <div class="mt-3 overflow-auto">
            <table>
              <thead><tr><th>Time</th><th>Match</th><th>Mode</th><th>Map</th><th>Player/Lead</th><th>PUBG ID</th><th>Phone</th><th>Remarks</th><th>Amount</th><th>Status</th><th>Verify</th></tr></thead>
              <tbody id="regTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </section>


  <footer class="border-t border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-6 text-sm text-neutral-400 flex flex-col md:flex-row items-start md:items-center justify-between gap-3">
      <div>© <span id="year"></span> ElitesBattle Esports — Nepal</div>
      <div class="flex items-center gap-4">
        <a href="https://facebook.com/" target="_blank" class="nav-link">Facebook</a>
        <a href="https://instagram.com/" target="_blank" class="nav-link">Instagram</a>
        <a href="https://www.tiktok.com/" target="_blank" class="nav-link">TikTok</a>
        <a href="https://youtube.com/" target="_blank" class="nav-link">YouTube</a>
      </div>
    </div>
  </footer>

  <div id="registerModal" class="fixed inset-0 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative z-10 w-full max-w-lg mx-auto glass card rounded-2xl p-5 max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Register for Match <span class="text-neutral-400 text-sm" id="regMatchId">#EBE-NEP-0001</span></h3>
        <button id="closeRegister" class="p-2 rounded-lg hover:bg-white/10" aria-label="Close">✕</button>
      </div>
      <form id="regForm" class="mt-4 space-y-3 text-sm">
        <div class="rounded-xl card p-3">
          <div class="text-neutral-400 text-xs">Current mode</div>
          <div class="font-semibold" id="currentModeInline">Solo</div>
        </div>
        <div>
          <label class="block mb-1">Player / Team Lead Name *</label>
          <input id="playerName" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="Your name" required />
        </div>
        <div>
          <label class="block mb-1">PUBG Mobile ID (numbers only) *</label>
          <input id="pubgId" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="e.g., 5123456789" required />
        </div>
        <div>
          <label class="block mb-1">Contact Number (WhatsApp/SMS) *</label>
          <p class="text-xs text-neutral-500 mb-1">Make sure you have WhatsApp/SMS on this number for coordination.</p>
          <input id="phone" class="w-full px-3 py-2 rounded-xl bg-neutral-900 border border-white/10" placeholder="+97798… or +447… or 98…" required />
        </div>
        <label class="flex items-start gap-2"><input id="waConsent" type="checkbox" class="mt-1" required><span>I agree to join the official Discord server/receive SMS for match coordination.</span></label>
        <label class="flex items-start gap-2"><input id="agreeRules" type="checkbox" class="mt-1" required><span>I confirm I am 16+ and I agree to the Rules and T&Cs.</span></label>
        <button id="proceedPaymentBtn" class="btn w-full py-2 rounded-xl bg-white text-black font-semibold" type="submit">Proceed to Payment</button>
        <p class="text-xs text-neutral-400">You’ll be taken to the payment section with your eSewa details.</p>
      </form>
    </div>
  </div>
  
  <div id="paymentModal" class="fixed inset-0 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative z-10 w-full max-w-md mx-auto glass card rounded-2xl p-6 max-h-[85vh] overflow-y-auto">
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold">Payment — eSewa</h2>
        <button id="closePaymentModal" class="p-2 rounded-lg hover:bg-white/10" aria-label="Close">✕</button>
      </div>
      
      <p class="mt-2 text-neutral-300">Complete payment within <span class="badge badge-amber">10 minutes</span> to secure your slot.</p>
      <div class="mt-4 grid grid-cols-2 gap-4">
        <div class="rounded-xl card p-4">
          <div class="text-neutral-400 text-sm">Pay to (eSewa)</div>
          <div class="flex items-center gap-2">
            <div id="payNumber" class="text-xl font-semibold">9817634997</div>
            <button id="copyNumber" class="btn px-2 py-1 rounded-lg border border-white/20 hover:bg-white/10 text-xs">Copy</button>
          </div>
        </div>
        <div class="rounded-xl card p-4">
          <div class="text-neutral-400 text-sm">Amount</div>
          <div id="payAmount" class="text-xl font-semibold">Rs 100</div>
        </div>
        <div class="rounded-xl card p-4 col-span-2">
          <div class="text-neutral-400 text-sm">Payment Remarks (use your PUBG ID for matching)</div>
          <div class="flex items-center gap-2">
            <div id="payRemarks" class="text-xl font-semibold">1234567890</div>
            <button id="copyRemarks" class="btn px-2 py-1 rounded-lg border border-white/20 hover:bg-white/10 text-xs">Copy</button>
          </div>
        </div>
      </div>
      <div class="mt-5 flex flex-wrap gap-3">
        <a href="https://esewa.com.np/#/home" target="_blank" id="openEsewa" class="btn px-4 py-2 rounded-xl bg-green-500 text-black font-semibold hover:bg-green-400">Pay in eSewa App</a>
        <button id="backToTournament" class="btn px-4 py-2 rounded-xl border border-white/20 hover:bg-white/10">Back to Tournament</button>
      </div>
      <p class="text-xs text-neutral-400 mt-3">Your slot is **PENDING VERIFICATION** until payment is confirmed. You will receive a Discord link/SMS shortly after payment confirmation.</p>
    </div>
  </div>

<div id="registeredPlayersModal" class="fixed inset-0 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative z-10 w-full max-w-4xl mx-auto glass card rounded-2xl p-5 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold">Registered Players for Match <span class="text-neutral-400 text-sm" id="regPlayersMatchId">#EBE-NEP-0001</span></h3>
            <button id="closeRegisteredPlayers" class="p-2 rounded-lg hover:bg-white/10" aria-label="Close">✕</button>
        </div>

        <div class="mt-4 flex gap-2">
            <button data-player-mode="solo" class="player-mode-btn active px-4 py-2 rounded-xl">Solo Players</button>
            <button data-player-mode="duo" class="player-mode-btn px-4 py-2 rounded-xl">Duo Players</button>
            <button data-player-mode="squad" class="player-mode-btn px-4 py-2 rounded-xl">Squad Players</button>
        </div>

        <div id="soloPlayersList" class="player-list mt-4 grid-auto grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
            <p class="text-neutral-400 col-span-full">No Solo players registered yet.</p>
        </div>
        <div id="duoPlayersList" class="player-list mt-4 hidden grid-auto grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
            <p class="text-neutral-400 col-span-full">No Duo players registered yet.</p>
        </div>
        <div id="squadPlayersList" class="player-list mt-4 hidden grid-auto grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
            <p class="text-neutral-400 col-span-full">No Squad players registered yet.</p>
        </div>

        <p class="text-xs text-neutral-400 mt-4">Players are listed in registration order. Status: **Pending Verification**.</p>
    </div>
</div>


  <script>
    // --- Configuration and Utilities ---
    //const API_BASE_URL = 'http://localhost:3000/api'; 
    const API_BASE_URL = 'https://elitesbattle-api.onrender.com/api';

    const el = id => document.getElementById(id);
    function isAuthed(){ return sessionStorage.getItem("ebe_authed")==="1"; }
    function logout(){ sessionStorage.removeItem("ebe_authed"); }
    function getNextMatchID(currentID) {
        const parts = currentID.split('-'); 
        if (parts.length < 3) return currentID + "-0002";
        const nextNumber = (parseInt(parts[2]) + 1).toString().padStart(4, '0');
        parts[2] = nextNumber;
        return parts.join('-');
    };

    // Initial state placeholders (will be filled by API)
    let state = {
        mode: "solo",
        matchSettings: { fees: { solo: 100, duo: 200, squad: 400 } }, 
        stats: { matches: 0, players: 0, winnings: 0, topReward: 0 },
        used: {},
        allRegistrations: []
    };

    // --- Core API Functions ---
    async function fetchData(endpoint, isAuthenticated = false) {
        const headers = { 'Content-Type': 'application/json' };
        if (isAuthenticated) {
            headers['Authorization'] = `Bearer ${sessionStorage.getItem('admin_token')}`;
        }
        try {
            const response = await fetch(`${API_BASE_URL}${endpoint}`, { headers });
            if (!response.ok) {
                if (response.status === 401 && isAuthenticated) {
                    logout();
                    location.hash = '#admin-login';
                }
                const errorData = await response.json().catch(() => ({ error: response.statusText }));
                throw new Error(errorData.error || response.statusText);
            }
            return await response.json();
        } catch (error) {
            console.error("Fetch failed:", error);
            if (endpoint === '/data') {
               alert("Could not connect to the tournament server. Ensure your backend is running.");
            }
            return null;
        }
    }

    async function postData(endpoint, data, isAuthenticated = false) {
        const headers = { 'Content-Type': 'application/json' };
        if (isAuthenticated) {
            headers['Authorization'] = `Bearer ${sessionStorage.getItem('admin_token')}`;
        }
        try {
            const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(data)
            });
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ error: response.statusText }));
                throw new Error(errorData.error || response.statusText);
            }
            return await response.json();
        } catch (error) {
            console.error("Post failed:", error);
            alert(`Error: ${error.message}`);
            return null;
        }
    }
    
    // --- UI Hooks ---
    const registeredPlayersModal = el('registeredPlayersModal');
    const registerModal = el('registerModal');
    const paymentModal = el('paymentModal');
    const proceedPaymentBtn = el('proceedPaymentBtn'); 
    
    // Global Modal Functions
    function openModal(modalEl) { modalEl.classList.remove('hidden'); modalEl.classList.add('flex'); }
    function closeModal(modalEl) { modalEl.classList.add('hidden'); modalEl.classList.remove('flex'); }
    
    function showToast(message) {
        const container = el('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        
        container.innerHTML = '';
        container.appendChild(toast);
        
        container.style.opacity = '1';
        container.style.transform = 'translateY(0)';
        
        setTimeout(() => {
            container.style.opacity = '0';
            container.style.transform = 'translateY(-10px)';
            // ensure it never overlays after fade
            setTimeout(()=>{ container.innerHTML=''; }, 350);
        }, 4000);
    }
    
    // Unified Modal Open/Close handlers
    el('closeRegister').addEventListener('click', () => closeModal(registerModal));
    el('closePaymentModal').addEventListener('click', () => closeModal(paymentModal));
    el('backToTournament').addEventListener('click', () => {
        closeModal(paymentModal);
        location.hash = '#tournament'; 
        showToast("Payment details saved. Your slot is PENDING VERIFICATION.");
    });
    el('closeRegisteredPlayers').addEventListener('click', () => closeModal(registeredPlayersModal));
    
    function showView(targetHash) {
        closeModal(registerModal);
        closeModal(paymentModal);
        closeModal(registeredPlayersModal);
        
        const publicView = el('public-view');
        const adminView = el('admin-view');
        const adminLogin = el('admin-login');
        const adminDashboard = el('admin');

        publicView.classList.remove('hidden-view');
        adminView.classList.add('hidden-view');
        adminLogin.classList.add('hidden');
        adminDashboard.classList.add('hidden');
        
        const hash = targetHash || location.hash;

        if (hash === '#admin' || hash === '#admin-login') {
            if (isAuthed() && hash === '#admin') {
                adminView.classList.remove('hidden-view');
                publicView.classList.add('hidden-view');
                adminDashboard.classList.remove('hidden');
                renderAdmin();
                adminDashboard.scrollIntoView({ behavior: 'smooth' });
            } else {
                logout(); 
                adminView.classList.remove('hidden-view');
                publicView.classList.add('hidden-view');
                adminLogin.classList.remove('hidden');
                adminLogin.scrollIntoView({ behavior: 'smooth' });
            }
        } else {
            publicView.classList.remove('hidden-view');
            const targetEl = el(hash.substring(1)) || el('top');
            targetEl.scrollIntoView({ behavior: 'smooth' });
        }
    }

    // Hash change handler and initial load
    window.addEventListener('hashchange', () => showView(location.hash));
    
    // --- Data Initialization ---
    async function initializeApp() {
        const data = await fetchData('/data');
        if (data) {
            state.matchSettings = data.matchSettings;
            state.stats = data.stats;
            state.used = data.used || {};
            renderMatch();
            renderStats();
            
            // Initial fetch for public registrations
            const allRegs = await fetchData('/public/registrations'); 
            if (allRegs) {
                state.allRegistrations = allRegs.registrations;
            }

            if (!location.hash) showView('#top');
            else showView(location.hash);
        }
        
        // Cookie Banner
        const banner = el('cookie-banner');
        if (localStorage.getItem('cookies_accepted') !== 'true') {
            banner.classList.add('show');
        }
        el('accept-cookies').addEventListener('click', () => {
            localStorage.setItem('cookies_accepted', 'true');
            banner.classList.remove('show');
        });
        el('deny-cookies').addEventListener('click', () => {
            localStorage.setItem('cookies_accepted', 'false');
            banner.classList.remove('show');
        });

        // One-time binder for Registered Players tabs (prevents duplicate listeners)
        setupRegisteredPlayersTabs();
    }
    initializeApp();

    // --- One-time event binding for Players modal tabs ---
    function setupRegisteredPlayersTabs(){
      const btns = document.querySelectorAll('.player-mode-btn');
      btns.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const mode = btn.dataset.playerMode;
          // toggle active state
          document.querySelectorAll('.player-mode-btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          // show corresponding list
          document.querySelectorAll('.player-list').forEach(list => list.classList.add('hidden'));
          el(`${mode}PlayersList`).classList.remove('hidden');
        });
      });
    }

    // --- Admin Auth ---
    el('adminLoginForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const pin = el('adminPin').value.trim();
        
        const result = await postData('/admin/login', { pin });

        if (result && result.token) {
            sessionStorage.setItem("admin_token", result.token);
            sessionStorage.setItem("ebe_authed", "1");
            location.hash = '#admin';
        } else if (result && result.error) {
            alert(result.error);
        } else {
            alert("Login failed due to network or server error.");
        }
    });

    el('logoutAdmin')?.addEventListener('click', () => {
        sessionStorage.removeItem('admin_token');
        logout();
        location.hash = '#admin-login';
    });

    // --- Public UI Rendering ---
    function countUp(elm, target, duration=1200){
      const start = performance.now(), from = 0;
      function frame(now){
        const p = Math.min(1,(now-start)/duration);
        const val = Math.floor(from + (target-from)*p);
        elm.textContent = val.toLocaleString();
        if(p<1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }
    function renderStats(){
      countUp(el('statMatches'), state.stats.matches); countUp(el('statPlayers'), state.stats.players);
      countUp(el('statWinnings'), state.stats.winnings); countUp(el('statTopReward'), state.stats.topReward);
    }

    function renderMatch(){
      if (!state.matchSettings.id) return;
      const currentMatchID = state.matchSettings.id;
      el('matchId').textContent = currentMatchID; el('regMatchId').textContent = "#"+currentMatchID;
      el('matchDate').textContent = state.matchSettings.date; el('checkin').textContent = state.matchSettings.checkin;
      el('map').textContent = state.matchSettings.map; el('slotMap').textContent = state.matchSettings.map;
      el('prize').textContent = state.matchSettings.prize;
      
      updateModeDisplay(state.mode);
    }

    function updateModeDisplay(newMode) {
        state.mode = newMode;
        const mapKey = state.matchSettings.map;

        // Ensure structure exists to avoid runtime errors on first load / after wipe
        state.used[mapKey] = state.used[mapKey] || { solo: 0, duo: 0, squad: 0 };

        const modeCap = state.matchSettings.caps[newMode];
        const modeFee = state.matchSettings.fees[newMode];
        const modeName = newMode[0].toUpperCase() + newMode.slice(1);

        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.mode === newMode) btn.classList.add('active');
        });

        el('currentEntryFee').textContent = `Rs ${modeFee}`;
        el('currentModeLabel').textContent = modeName;
        el('currentModeInline').textContent = modeName;
        el('regModeBtn').textContent = modeName;

        const sg = el('slotGrid'); sg.innerHTML = '';
        const usedMap = state.used[mapKey];
        const remaining = Math.max(0, modeCap - (usedMap[newMode] || 0));
        
        const div = document.createElement('div');
        div.className='rounded-xl card p-3';
        div.innerHTML=`
          <div class="uppercase tracking-wide text-neutral-400">${newMode}</div>
          <div class="mt-1 text-2xl font-semibold">${remaining}</div>
          <div class="text-neutral-400">left / ${modeCap}</div>`;
        sg.appendChild(div);
    }

    // Mode Switcher Listeners
    document.querySelectorAll('#modeSwitcher .mode-btn').forEach(button => {
        button.addEventListener('click', (e) => {
            const mode = button.dataset.mode;
            document.querySelectorAll('#modeSwitcher .mode-btn').forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');
            updateModeDisplay(mode);
        });
    });

    // Registration Modal Open
    document.getElementById('openRegister2').addEventListener('click', () => openModal(registerModal));
    document.getElementById('openRegister3').addEventListener('click', () => openModal(registerModal));

    // Registered Players Modal Handler
    document.getElementById('viewRegisteredPlayersBtn').addEventListener('click', async () => {
        const allRegs = await fetchData('/public/registrations');
        if (allRegs) {
            state.allRegistrations = allRegs.registrations;
            renderRegisteredPlayers();
            openModal(registeredPlayersModal);
        }
    });

    // Registration → Payment
    document.getElementById('regForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      
      proceedPaymentBtn.textContent = 'Processing...';
      proceedPaymentBtn.disabled = true;

      const name=el('playerName').value.trim();
      let pubg=el('pubgId').value.trim();
      let phone=el('phone').value.trim();
      
      pubg = pubg.replace(/\s+/g,''); phone = phone.replace(/\s+/g,'');
      
      const type = state.mode; 
      const amount = state.matchSettings.fees[type];
      const remarks = pubg; 

      if(!name || !pubg || !phone || !el('waConsent').checked || !el('agreeRules').checked || !/^\d{6,15}$/.test(pubg)){
          alert('Please check all fields and agree to the terms.');
          proceedPaymentBtn.textContent = 'Proceed to Payment';
          proceedPaymentBtn.disabled = false;
          return;
      }
      
      const result = await postData('/register', {
          player_name: name,
          pubg_id: pubg,
          phone: phone,
          mode: type,
          amount: amount 
      });

      if (result) {
          const mapKey = state.matchSettings.map;
          state.used[mapKey] = state.used[mapKey] || { solo: 0, duo: 0, squad: 0 };
          state.used[mapKey][type] = (state.used[mapKey][type] || 0) + 1;
          updateModeDisplay(type); 

          sessionStorage.setItem('temp_pay_amount', amount);
          sessionStorage.setItem('temp_pay_remarks', remarks);

          closeModal(el('registerModal'));
          renderPayment(); 
          openModal(el('paymentModal'));
          showToast("Registration successful! Proceed with payment.");
          el('regForm').reset();
      }
      
      proceedPaymentBtn.textContent = 'Proceed to Payment';
      proceedPaymentBtn.disabled = false;
    });

    // Payment Page Render
    function renderPayment(){
        const amount = sessionStorage.getItem('temp_pay_amount') || '100';
        const remarks = sessionStorage.getItem('temp_pay_remarks') || '1234567890';
        
        el('payAmount').textContent = `Rs ${amount}`;
        el('payRemarks').textContent = remarks;

        document.getElementById('copyNumber').onclick = () => {
            navigator.clipboard.writeText(el('payNumber').textContent.trim());
            alert('eSewa number copied!');
        };
        document.getElementById('copyRemarks').onclick = () => {
            navigator.clipboard.writeText(el('payRemarks').textContent.trim());
            alert('Payment Remarks copied!');
        };
        document.getElementById('openEsewa').onclick = () => {
          const to = el('payNumber').textContent.trim();
          const amt = el('payAmount').textContent.replace(/[^\d]/g,'');
          const remarks = el('payRemarks').textContent.trim();
          const schemeUrl = `esewa://pay?to=${encodeURIComponent(to)}&amount=${encodeURIComponent(amt)}&remarks=${encodeURIComponent(remarks)}`;
          const fallbackMsg = "If the eSewa app doesn't open, copy the number and remarks, then pay manually.";
          const i = document.createElement('iframe'); i.style.display='none'; i.src = schemeUrl;
          document.body.appendChild(i);
          setTimeout(()=>{ document.body.removeChild(i); alert(fallbackMsg); }, 1200);
        };
    }
    
    // Poll
    el('pollForm')?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      
      const item = {
        date_choice:el('pollDate').value,
        map_choice:el('pollMap').value, 
        time_choice:el('pollTime').value,
        mode_choice:el('pollMode').value
      };

      const result = await postData('/poll', item);

      if (result) {
        showToast("Thanks for voting! Your poll has been saved.");
        el('pollForm').reset();
      }
    });

    // --- Admin Dashboard Logic ---
    async function renderAdmin(){
        const token = sessionStorage.getItem('admin_token');
        if (!token) return;

        const data = await fetchData('/admin/registrations', true); 

        if (data && data.registrations) {
            const currentMatchID = data.currentMatchId;
            el('regMatchIdTitle').textContent = currentMatchID; 
            
            const tb = el('regTable'); tb.innerHTML = '';
            data.registrations.slice().reverse().forEach(r=>{
                const tr = document.createElement('tr');
                const isVerified = r.status === 'VERIFIED';
                const checkboxHtml = `<input type="checkbox" data-pubgid="${r.pubg_id}" onchange="updateVerificationStatus(this)" ${isVerified ? 'checked' : ''}>`;

                tr.innerHTML = `
                    <td>${r.timestamp}</td><td>${r.match_id}</td><td>${r.mode}</td><td>${state.matchSettings.map}</td>
                    <td>${r.player_name}</td><td>${r.pubg_id}</td><td>${r.phone}</td>
                    <td><span class="badge badge-amber">${r.remarks}</span></td><td>Rs ${r.amount}</td>
                    <td>${r.status.replace('_', ' ')}</td>
                    <td>${checkboxHtml}</td>
                `;
                tb.appendChild(tr);
            });
            
            const nextMatchId = getNextMatchID(currentMatchID);
            el('admMatchId').value = nextMatchId; 
            el('admMatchDate').value = state.matchSettings.date;
            el('admCheckin').value = state.matchSettings.checkin;
            el('admMap').value = state.matchSettings.map;
            el('admPrize').value = state.matchSettings.prize;
            el('admFeeSolo').value = state.matchSettings.fees.solo;
            el('admFeeDuo').value = state.matchSettings.fees.duo;
            el('admFeeSquad').value = state.matchSettings.fees.squad;
            el('admCapSolo').value = state.matchSettings.caps.solo;
            el('admCapDuo').value = state.matchSettings.caps.duo;
            el('admCapSquad').value = state.matchSettings.caps.squad;

        } else if (!data) {
             el('regMatchIdTitle').textContent = "---";
             el('regTable').innerHTML = '<tr><td colspan="11" class="text-center text-red-400">Error loading data. Check console.</td></tr>';
        }
    }
    
    // Admin verification
    async function updateVerificationStatus(checkbox) {
        const pubgId = checkbox.dataset.pubgid;
        const newStatus = checkbox.checked ? 'VERIFIED' : 'PENDING_VERIFICATION';
        
        const result = await postData('/admin/verify', { pubg_id: pubgId, status: newStatus }, true);
        
        if (result) {
            showToast(result.message);
            renderAdmin(); 
        } else {
            checkbox.checked = !checkbox.checked;
        }
    }
    window.updateVerificationStatus = updateVerificationStatus;

    // Registered Players renderer (no tab listeners here)
    function renderRegisteredPlayers() {
        const soloList = el('soloPlayersList');
        const duoList = el('duoPlayersList');
        const squadList = el('squadPlayersList');

        soloList.innerHTML = '';
        duoList.innerHTML = '';
        squadList.innerHTML = '';

        const registeredMatchId = state.matchSettings.id;
        el('regPlayersMatchId').textContent = "#" + registeredMatchId;

        const soloPlayers = state.allRegistrations.filter(r => r.mode === 'solo' && r.match_id === registeredMatchId);
        const duoPlayers = state.allRegistrations.filter(r => r.mode === 'duo' && r.match_id === registeredMatchId);
        const squadPlayers = state.allRegistrations.filter(r => r.mode === 'squad' && r.match_id === registeredMatchId);

        function createPlayerCard(player, index) {
            const teamNumber = index + 1;
            const statusClass = player.status === 'VERIFIED' ? 'text-emerald-400' : 'text-yellow-400';
            const statusText = player.status.replace('_', ' ');

            return `
                <div class="rounded-xl card p-3 flex flex-col justify-between">
                    <div>
                        <div class="text-neutral-400 text-xs">TEAM #${teamNumber} | <span class="${statusClass}">${statusText}</span></div>
                        <div class="font-semibold text-lg leading-tight">${player.player_name}</div>
                    </div>
                    <div class="mt-2 text-sm text-neutral-300">
                        <span class="block text-xs text-neutral-500">PUBG ID:</span>
                        <span class="font-mono">${player.pubg_id}</span>
                    </div>
                </div>
            `;
        }

        soloPlayers.length
          ? soloPlayers.forEach((p,i)=> soloList.innerHTML += createPlayerCard(p,i))
          : soloList.innerHTML = '<p class="text-neutral-400 col-span-full">No Solo players registered yet.</p>';

        duoPlayers.length
          ? duoPlayers.forEach((p,i)=> duoList.innerHTML += createPlayerCard(p,i))
          : duoList.innerHTML = '<p class="text-neutral-400 col-span-full">No Duo players registered yet.</p>';

        squadPlayers.length
          ? squadPlayers.forEach((p,i)=> squadList.innerHTML += createPlayerCard(p,i))
          : squadList.innerHTML = '<p class="text-neutral-400 col-span-full">No Squad players registered yet.</p>';
    }

    // --- Admin Buttons ---
    document.getElementById('matchForm')?.addEventListener('submit', async (e)=>{
        e.preventDefault(); 
        if(!isAuthed()) return alert('Please login again.');

        const payload = {
            id: el('admMatchId').value.trim(),
            matchDate: el('admMatchDate').value.trim(),
            checkin: el('admCheckin').value.trim(),
            map: el('admMap').value,
            prize: el('admPrize').value.trim(),
            feeSolo: el('admFeeSolo').value,
            feeDuo: el('admFeeDuo').value,
            feeSquad: el('admFeeSquad').value,
            capSolo: el('admCapSolo').value,
            capDuo: el('admCapDuo').value,
            capSquad: el('admCapSquad').value,
        };

        const result = await postData('/admin/matchsettings', payload, true); 

        if (result) {
            state.matchSettings = result.matchSettings;
            renderMatch();
            renderAdmin();
            alert(`New match (${result.matchSettings.id}) settings published!`);
        }
    });

    document.getElementById('clearMatchData')?.addEventListener('click', async () => {
        if(!isAuthed()) return alert('Please login again.');
        if(!confirm(`Are you sure you want to permanently clear all registrations and poll data for the current match (${state.matchSettings.id})?`)){ return; }

        const result = await postData('/admin/clearmatch', { id: state.matchSettings.id }, true);

        if (result) {
            alert(result.message);
            const newData = await fetchData('/data');
            if (newData) {
                state.used = newData.used || {};
                renderMatch(); 
                renderAdmin();
            }
        }
    });
    
    document.getElementById('wipeAllData')?.addEventListener('click', async () => {
        if(!isAuthed()) return alert('Please login again.');
        if(!confirm("DANGER ZONE: Are you sure you want to PERMANENTLY WIPE ALL TOURNAMENT DATA? This will reset the site to Match ID EBE-NEP-0001.")){ return; }

        const result = await postData('/admin/wipeall', {}, true);

        if (result) {
            alert(result.message);
            const newData = await fetchData('/data');
            if (newData) {
                state.matchSettings = newData.matchSettings;
                state.used = newData.used || {};
                renderMatch(); 
                renderAdmin();
            }
        }
    });

    document.getElementById('pinForm')?.addEventListener('submit', async (e)=>{
        e.preventDefault(); 
        if(!isAuthed()) return alert('Please login again.');

        const newPin = el('newPin').value.trim();
        if (newPin.length < 4) { alert("PIN must be at least 4 characters."); return; }
        
        const result = await postData('/admin/updatepin', { newPin: newPin }, true);

        if (result) {
             alert(result.message);
             el('newPin').value = '';
        }
    });

    // --- Exports ---
    function toCSV(rows){
      if(!rows.length) return '';
      const keys = Object.keys(rows[0]);
      const esc = v => '"' + String(v??'').replaceAll('"','""') + '"';
      const header = keys.map(esc).join(',');
      const body = rows.map(r => keys.map(k => esc(r[k])).join(',')).join('\n');
      return header + (body?('\n'+body):'');
    }
    function downloadCSV(filename, rows){
      if(!rows.length){ alert('Nothing to export yet.'); return; }
      const blob = new Blob([toCSV(rows)], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download=filename; a.click();
      URL.revokeObjectURL(url);
    }
    
    document.getElementById('exportRegsAdmin')?.addEventListener('click', async ()=>{
        if(!isAuthed()) return alert('Please login.');
        const data = await fetchData('/admin/registrations', true); 
        
        if (data && data.registrations) {
            const exportData = data.registrations.map(reg => ({
                Timestamp: reg.timestamp, MatchID: reg.match_id, Mode: reg.mode, 
                Map: state.matchSettings.map,
                PlayerName: reg.player_name, PUBGID: reg.pubg_id, Phone: reg.phone,
                Remarks: reg.remarks, Amount: reg.amount, Status: reg.status
            }));
            downloadCSV(`registrations_${data.currentMatchId}.csv`, exportData);
        }
    });

    document.getElementById('exportAllRegsAdmin')?.addEventListener('click', ()=>{
        if(!isAuthed()) return alert('Please login.');
        alert("Feature requires a dedicated 'Export All' API endpoint, exporting current match data instead.");
        document.getElementById('exportRegsAdmin').click();
    });
    
    document.getElementById('exportPollAdmin')?.addEventListener('click', async ()=>{
        if(!isAuthed()) return alert('Please login.');
        const data = await fetchData('/admin/polls', true); 
        if (data && data.polls && data.polls.length > 0) {
            const exportData = data.polls.map(poll => ({
                Timestamp: poll.timestamp,
                Map_Choice: poll.map_choice,
                Mode_Choice: poll.mode_choice,
                Date_Choice: poll.date_choice,
                Time_Choice: poll.time_choice
            }));
            downloadCSV(`polls_${data.currentMatchId}.csv`, exportData);
        } else if (data) {
            alert("No poll data found for current match.");
        }
    });

    // --- Final Initialization for Payment Handlers ---
    document.getElementById('copyNumber').addEventListener('click', ()=>{
      navigator.clipboard.writeText(el('payNumber').textContent.trim());
    });
    document.getElementById('copyRemarks').addEventListener('click', ()=>{
      navigator.clipboard.writeText(el('payRemarks').textContent.trim());
    });
    document.getElementById('openEsewa').addEventListener('click', ()=>{
      const to = el('payNumber').textContent.trim();
      const amt = el('payAmount').textContent.replace(/[^\d]/g,'');
      const remarks = el('payRemarks').textContent.trim();
      const schemeUrl = `esewa://pay?to=${encodeURIComponent(to)}&amount=${encodeURIComponent(amt)}&remarks=${encodeURIComponent(remarks)}`;
      const fallbackMsg = "If the eSewa app doesn't open, copy the number and remarks above, then pay manually in the app.";
      const i = document.createElement('iframe');
      i.style.display='none'; i.src = schemeUrl;
      document.body.appendChild(i);
      setTimeout(()=>{ document.body.removeChild(i); alert(fallbackMsg); }, 1200);
    });
  </script>
</body>
</html>
